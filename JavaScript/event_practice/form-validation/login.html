<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <script>
                // Code runs before the DOM is fully loaded
                let checkCookie=()=>{
                    let cookie = document.cookie.split(';');
                    let obj = {};
                    let maps = cookie.map((val) => {
                    let [key, value] = val.split('=');
                    obj[key.trim()] = value.trim();
                    });
                    console.log(obj);
                    if(obj["isAuthenticate"]=="true"){
                        window.history.replaceState(null, '', 'Authentication.html'); 
                        location.href="Authentication.html";   
                    } 
                }
               checkCookie();
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/3f2c09a521.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="outer-box">
        <div class="round-1"></div>
        <div class="round-2"></div>
        <div class="round-3"></div>
        <div class="round-4"></div>
        <div class="round-5"></div>
        <div class="round-6"></div>

        <div class="container rounded-4">
            <h2 class="text-center text-light mb-4">Login Form</h2>
            <form action="" class="d-flex flex-column text-light gap-4">
                <p id="usernameError" class="error alert alert-danger"></p>
                <div class="d-flex flex-column gap-4">
                    <label for="uname">
                        <input type="text" id="uname" placeholder="Enter Username" autocomplete="off">
                    </label>
                    <label for="pwd" class="password-container">
                    <input type="password" id="pwd" placeholder="Enter Password" autocomplete="off">
                    <i class="fa-solid fa-eye" id="icon-eye"></i>
                    <i class="fa-solid fa-eye-slash" id="icon-eye-slash" style="display: none;"></i>
                </label>

                </div>
                <div class="d-flex flex-column gap-2">
                    <button type="submit" id="submit" class="btn fw-semibold rounded-5 w-75 mt-3">Submit</button>
                    <div class="mt-2">Don't have an account? <a href="./index.html" class="text-light fw-semibold">Register</a></div>
                </div>
            </form>
        </div>
        <div class="successMsg p-2 rounded bg-light w-25" id="successMessage">
            <i class="fa-solid fa-circle-check fa-lg text-success"></i> Login successfully
        </div>
        <div class="successMsg p-2 rounded bg-light w-25" id="ErrorMessage">
            <i class="fa-solid fa-circle-exclamation fa-lg" style="color: red;margin-right: 5px;"></i> 
        </div>

    </div>

    <script>
        // Select elements
        const uname = document.getElementById("uname");
        const pwd = document.getElementById("pwd");
        const msg = document.getElementById("error-msg");

        //user data from localStorage
        const users = JSON.parse(localStorage.getItem("user")) || [];
        console.log(users);

        // Add submit event listener to the form
        document.querySelector("form").addEventListener("submit", (e) => {
            e.preventDefault();

            const error = {};

            // Validate input fields
            if (uname.value.trim() == "" || pwd.value.trim() == "") {
                error.required = "* Please enter all fields.";
            } else {
                // Find the user in the stored data
                const foundUser = users.find(user =>
                    user.uname === uname.value.trim() && user.pwd === pwd.value.trim()
                );

                // Check if user was found
                if (!foundUser) {
                    error.validData = "Please enter a correct username and password";
                }
            }

            if (error && Object.keys(error).length !== 0) {
                // Display errors
                
                // Clear previous error messages
                document.getElementById("usernameError").innerHTML = '';
                
                // Display new error messages
                if(error.required){
                    document.querySelectorAll(".error").forEach((e) => e.style.display = "block");
                    document.getElementById("usernameError").innerHTML = error.required || '';
                }
                else{
                    document.getElementById("usernameError").style.display = "none";
                    document.getElementById("ErrorMessage").innerHTML +=error.validData || '';
                    Errormessage();
                }


            } else {
                if (!error || Object.keys(error).length === 0) {
                    document.getElementById("usernameError").style.display = "none";
                    // Show success message
                    const successMessage = document.getElementById("successMessage");
                    successMessage.style.display = "block";
                    const d = new Date();
                    d.setTime(d.getTime() + (7 * 24 * 60 * 60 * 1000));
                    const expires = `expires=${d.toUTCString()}`;
                    document.cookie=`username=${uname.value};${expires}`;
                    document.cookie="isAuthenticate=true;"+expires;
                    //hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = "none";
                        window.history.replaceState(null, '', 'Authentication.html'); 
                        location.href="Authentication.html";    
                    }, 3000);
                    document.querySelector("form").reset();
                } else {
                    document.getElementById("usernameError").style.display = "none";
                }
            }

        });
        function Errormessage(){
            const errorMessage = document.getElementById("ErrorMessage");
            errorMessage.style.display = "block";

            //hide the message after 3 seconds
            setTimeout(() => {
                errorMessage.style.display = "none";
                location.reload();
            }, 3000);
            document.querySelector("form").reset();
        }
        function togglePassword(eyeIcon, eyeSlash, passwordField) {
            if (passwordField.type === "password") {
              passwordField.type = "text";
              eyeIcon.style.display = "none";
              eyeSlash.style.display = "block";
            } else {
              passwordField.type = "password";
              eyeIcon.style.display = "block";
              eyeSlash.style.display = "none";
            }
          }
          
          //password elements
          let eyeIcon = document.getElementById("icon-eye");
          let eyeSlash = document.getElementById("icon-eye-slash");
          let password = document.getElementById("pwd");
          // Event listeners 
eyeIcon.addEventListener("click", () => {
    togglePassword(eyeIcon, eyeSlash, password);
  });
  eyeSlash.addEventListener("click", () => {
    togglePassword(eyeIcon, eyeSlash, password);
  });
       
    </script>

</body>
</html>

